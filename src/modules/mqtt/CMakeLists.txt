CMAKE_MINIMUM_REQUIRED	( VERSION 2.8 )
PROJECT			( artik-api-mqtt C )

FIND_PACKAGE ( Mosquitto )
FIND_PACKAGE ( OpenSSL )

SET ( LIB_MQTT artik-sdk-mqtt CACHE INTERNAL "" FORCE )
SET ( ARTIK_MQTT_INCLUDE_DIR ${LIB_INC}/mqtt CACHE INTERNAL "" FORCE )
SET ( ARTIK_MQTT_LIBRARIES ${LIB_MQTT} CACHE INTERNAL "" FORCE )

SET ( SRC_MQTT
	artik_mqtt.c
	os_mqtt.c
	linux/mqtt_client.c
	cpp/artik_mqtt.cpp
)

INCLUDE_DIRECTORIES ( ${CMAKE_CURRENT_SOURCE_DIR} linux )

ADD_LIBRARY ( ${LIB_MQTT} SHARED ${SRC_MQTT} )

TARGET_LINK_LIBRARIES ( ${LIB_MQTT} ${LIB_BASE} ${LIBMOSQUITTO_LIBRARIES} ${OPENSSL_LIBRARIES})

TARGET_INCLUDE_DIRECTORIES ( ${LIB_MQTT} PUBLIC
	${ARTIK_BASE_INCLUDE_DIR}
	${ARTIK_MQTT_INCLUDE_DIR}
	${LIBMOSQUITTO_INCLUDE_DIR}
	${OPENSSL_INCLUDE_DIR}
	${ARTIK_BASE_INCLUDE_DIR}/cpp
	${ARTIK_MQTT_INCLUDE_DIR}/cpp
)

SET_TARGET_PROPERTIES ( ${LIB_MQTT} PROPERTIES VERSION ${LIB_VERSION_MAJOR}.${LIB_VERSION_MINOR}.${LIB_VERSION_PATCH} SOVERSION ${LIB_VERSION_MAJOR} OUTPUT_NAME ${LIB_MQTT})

INSTALL ( TARGETS ${LIB_MQTT} LIBRARY DESTINATION "${CMAKE_INSTALL_LIBDIR}" )
FILE ( GLOB MQTT_HEADERS "${LIB_INC}/mqtt/*.h" )
FILE ( GLOB MQTT_HEADERS_CPP "${LIB_INC}/mqtt/cpp/*.hh" )
INSTALL ( FILES ${MQTT_HEADERS} DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}/artik/mqtt" )
INSTALL ( FILES ${MQTT_HEADERS_CPP} DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}/artik/mqtt/cpp" )
